!function(){$("#main_content").show();var loginLogic=new function(view,submit){var that=this;this.init=function(){var errCode=location.href.split("?")[1]||"0";switch(errCode){case"1":$("#loginPwdWrap").addClass("shake"),0<$("#loginLangWrap").length&&$("#loginLangWrap").addClass("shake"),view.showInvalidError(_("Password error!"));break;case"2":view.showInvalidError(_("Up to 4 administrators have logged in.")),$("#loginWrap").addClass("fly-in");break;case"3":$("#loginWrap").addClass("none"),$("#overUserWrap").removeClass("none").addClass("fly-in");break;case"10":case"11":case"12":case"13":case"14":var n=+errCode-10;0<+n?1==n?view.showInvalidError(_("Incorrect password, please try again. 1 attempt left")):view.showInvalidError(_("Incorrect password, please try again. %s attempts left",[n])):view.showInvalidError(_("5 login attempts failed. Please try again 3 min later"));break;default:$("#loginWrap").addClass("fly-in")}view.initHtml(),view.addEvent(),this.addValidate(),view.addSubmitEvent(function(){that.validate.checkAll()});var lang=B.getLang();$("#country").val(lang),setTimeout(function(){$("#login-password_")&&0<$("#login-password_").length?$.isHidden($("#login-password_")[0])?$("#login-password").focus():$("#login-password_").focus():$("#login-password").focus()},400)},this.addValidate=function(){this.validate=$.validate({custom:function(){if(!function(password){return""!==password}(view.getVal("login-password"))){return _("Please specify a login password.")}},success:function(){view.getSubmitData(),B.setLang($("#country").attr("data-val")),document.forms[0].submit()},error:function(msg){view.showInvalidError(msg)}})}}(new function(encode){var that=this;this.getVal=function(elem){return elem&&0<$("#"+elem).length?$("#"+elem).val():void 0},this.initHtml=function(){var str,supportLang=B.options.support,len=supportLang.length,i=0;for(str="<div class='dropdown'>",str+="<div class='addLang'>",str+="<span class='lang'>"+B.langArr[B.lang]+"</span>",str+="<span class='caret'></span>",str+="</div>",str+="<ul class='dropdown-menu'>",i=0;i<len;i++){lang=supportLang[i],str+="<li data-val='"+lang+"'><a>"+B.langArr[lang]+"</a></li>"}str+="</ul>",str+="</div>",$("#country").html(str),$("#country").attr("data-val",B.lang),$("img[name = 'logo']").each(function(){$(this).attr("src",LOGO)})},this.addEvent=function(){$("#login-password").initPassword(_("Login Password"),!0),document.onkeydown=function(e){that.enterDown(e)},$("#save").on("click",function(e){loginLogic.validate.checkAll()}),$("#country .addLang").on("click",function(){$.isHidden($("#country .dropdown-menu")[0])?$("#country .dropdown-menu").show():$("#country .dropdown-menu").hide()}),$("#country .dropdown-menu li").on("click",function(){var lang=$(this).attr("data-val");$("#country").attr("data-val",lang),$("#country .dropdown-menu").hide(),$("#country .lang").html(B.langArr[lang]),B.setLang(lang),window.location.reload(!0)}),$(document).on("click",function(e){(e.target||e.srcElement)!=$("#country .addLang")[0]&&$("#country .dropdown-menu").hide()})},this.enterDown=function(events){var e=events||window.event;return 13==(e.charCode||e.keyCode)&&(e.preventDefault?e.preventDefault():e.returnValue=!1,loginLogic.validate.checkAll()),!1},this.getSubmitData=function(){$("#password").val(encode(this.getVal("login-password")))},this.showInvalidError=function(str){$("#errMsg").html("&nbsp;"),setTimeout(function(){$("#login-password_")&&0<$("#login-password_").length?$.isHidden($("#login-password_")[0])?$("#login-password").focus():$("#login-password_").focus():$("#login-password").focus()},400),setTimeout(function(){$("#errMsg").html(str)},200)},this.successCallback=function(str){0==($.parseJSON(str).errCode||"-1")?window.location.href="./index.html":that.showInvalidError(_("Password error!"))};var clickTipsFlag=!0;this.addSubmitEvent=function(callBack){$("#forgotCaret").on("click",function(){clickTipsFlag&&(clickTipsFlag=!1,$("#login-caret").hasClass("active")?($(".forget-info").fadeIn(600,function(){clickTipsFlag=!0}),$("#login-caret").removeClass("active")):($(".forget-info").fadeOut(600,function(){clickTipsFlag=!0}),$("#login-caret").addClass("active")))})}}(new Encode),new function(){this.login=function(obj){$.ajax({url:obj.url,type:"POST",data:obj.subData,success:obj.successCallback,error:obj.errorCallback})}});(window.loginLogic=loginLogic).init()}();